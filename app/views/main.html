<script>$('#nav-master').css('display','block');</script> <!-- Turn the nav on! -->

<div ng-controller="PostsCtrl">
  <div ng-show="signedIn()" class="main-body-background">
  <div class="container-fluid content-section">

    <!-- Button link for new post -->
    <div class="row text-center">
      <div class="col-md-6 col-md-offset-3 background-white new-post-button-section">
        <button type="button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#newPostModal">New Post</button> 
      </div>
    </div>
      
    <!-- Add New Post Modal --> 
    <div class="modal fade" id="newPostModal" tabindex="-1" role="dialog" aria-labelledby="newPostModalLabel" aria-hidden="true"> 
      <div class="modal-dialog"> 
        <form class="modal-content" ng-submit="submitPost()" ng-show="signedIn()"> 
          <div class="modal-header"> 
            <button type="button" class="close" data-dismiss="modal"><spanaria-hidden="true">×</span><spanclass="sr-only"></span></button> 
            <h4 class="modal-title" id="newPostModalLabel">New Post</h4> 
          </div> 
          <div class="modal-body">
            <div class="row">
              <div class="col-xs-8">
                <input type="text" class="form-control" placeholder="Title" ng-model="post.title">
              </div>
              <div class="col-xs-4">
                <select id="post-label" class="form-control"> 
                  <option selected disabled>Label</option>
                  <option>Projects</option>
                  <option>Tutorials</option> 
                  <option>Fun</option> 
                  <option>Misc</option> 
                </select>
              </div>
            </div> 
            <textarea class="form-control" rows="3" placeholder="Post" ng-model="post.content"></textarea> 
          </div> 
          <div class="modal-footer"> 
            <button type="button" ng-click="resetForm()" class="btn btn-default" data-dismiss="modal">Cancel</button> 
            <button type="submit" class="btn btn-primary">Post</button> 
          </div> 
        </form> 
      </div> 
    </div>
    <!-- Add New Post Modal End -->


    <!-- Main Post Template -->
    <div class="post-template" ng-repeat="post in reverse(posts)">
      <div class="row">
        <div class="col-md-6 col-md-offset-3 background-white post-main">
          <img ng-src="{{ post.creatorAvatar }}" />
          <ul class="list-group">
            <li class="list-group-item">
	            <i class="badge" data-toggle="modal" data-target="#viewPostModal" ng-click="getPostId(post.$id)">0</i>
            </li>
          </ul>

          <h5>
            <span class="post-title">{{ post.title }}</span><br />
            <span class="timestamp">
              <a ng-click="getUserPosts(post.creatorUID)">{{ post.creator }}</a> - 
              <a ng-click="getDatePosts(post.postDate)">{{ post.postTime }} {{ post.postDate }}</a> - 
              <a ng-click="getKeywordPosts(post.keyword)">{{ post.keyword }}</a>
            </span>
          </h5>
          <p>{{ post.content }}</p>
				</div>
      </div>
    </div>
    <!-- Individual Post Template End -->


    <!-- View Post Modal -->
		<div class="modal fade" id="viewPostModal" tabindex="-1" role="dialog" aria-labelledby="viewPostModalLabel" aria-hidden="true"> 
      <div class="modal-dialog"> 

      	<div class="modal-content">
		      <div class="modal-header"> 
		      	<img ng-src="{{ viewPost.creatorAvatar }}" />
		        <button type="button" class="close" data-dismiss="modal"><spanaria-hidden="true">×</span><span class="sr-only"></span></button> 
		        <h4 class="modal-title" id="viewPostModalLabel">{{ viewPost.title }}</h4>
		        <h4 class="timestamp">
	              <span>{{ viewPost.creator }} - 
	              {{ viewPost.postTime }} {{ viewPost.postDate }} - 
	              {{ viewPost.keyword }}</span>
		        </h4>
		      </div> 

		      <div class="modal-body">
		      	<div class="post-content">
		        	<h4>{{ viewPost.content }}</h4>
		        </div>

		        <div class="post-template" ng-repeat="reply in replies">
		        	<div class="row">
		        		<div class="background-white post-main">
		        			<!-- This should click and load a persons profile. Another modal??? -->
          				<img ng-src="{{ reply.creatorAvatar }}" /> 
				          <h5><span class="timestamp">
              			{{ reply.creator }} - 
              			{{ reply.postTime }} {{ reply.postDate }}
            			</span></h5>
          				<p>{{ reply.content }}</p>
								</div>
		        	</div>
		        </div>
		      </div> 

		      <form class="modal-footer" ng-submit="addReply(viewPost)"> 
	      		<textarea class="form-control" rows="3" placeholder="Reply" ng-model="reply.content"></textarea> 
		        <div class="col-xs-4 col-xs-offset-4">
		          <button type="button" id="cancel-reply" ng-click="resetForm()" class="btn btn-default" data-dismiss="modal">Cancel</button>
		        </div>
		        <div class="col-xs-4">
		          <button type="submit" class="btn btn-primary">Post</button> 
		        </div>
		      </form>
	      </div>
      </div> 
    </div>
    <!-- View Post Modal End-->

    <!-- Button link for more posts -->
    <div class="row text-center">
      <div class="col-md-6 col-md-offset-3 background-white more-post-button-section">
        <button type="button" class="btn btn-default btn-lg btn-block">More Posts</button> 
      </div>
    </div>
  <!-- End Main Content container -->
  </div>
</div> 
